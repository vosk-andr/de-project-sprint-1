Набор скриптов для создания и инкрементального обновления витрины данных в PostgreSQL.

# Требования к витрине
Витрина `customer_report_datamart` содержит следующие показатели по заказчикам за месяц:

**Основная информация:**
- Идентификатор записи и заказчика
- Ф.И.О., адрес, дата рождения, email заказчика

**Финансовые показатели:**
- Сумма потраченных средств заказчиком
- Доход платформы (10% от суммы заказов)
- Количество заказов и средняя стоимость заказа
- Медианное время выполнения заказа (дни)

**Аналитические показатели:**
- Самая популярная категория товаров
- Идентификатор самого популярного мастера

**Статистика по статусам заказов:**
- Количество созданных заказов за месяц
- Количество заказов в процессе изготовки за месяц
- Количество заказов в доставке за месяц
- Количество завершённых заказов за месяц
- Количество незавершённых заказов за месяц

**Отчётность:**
- Отчётный период (год-месяц)

# Источники данных
- **source1:**
  - `craft_market_wide` (широкая таблица)
- **source2:**
  - `craft_market_masters_products` (мастера и товары)
  - `craft_market_orders_customers` (заказы и заказчики)
- **source3:**
  - `craft_market_orders` (заказы и товары)
  - `craft_market_craftsmans` (мастера)
  - `craft_market_customers` (заказчики)
- **external_source:**
  - `craft_products_orders` (мастера, товары и заказы)
  - `customers` (заказчики)

# Процесс загрузки

## Шаг 1: Создание таблиц в слое DWH
**Файл:** `DDL_create_table.sql`

Создает:
- **Таблицы измерений**: `d_craftsman`, `d_product`, `d_customer`
- **Фактовая таблица**: `f_order`
- **Витрина данных**: `customer_report_datamart`
- **Таблица загрузок**: `load_dates_customer_report_datamart`

## Шаг 2: Преобразование и загрузка данных
**Файл:** `SQL_add_external_source.sql`

Процесс:
1. Приводит данные из источников к общему виду и объединяет во временную таблицу `tmp_sources`
2. Инкрементально обновляет факты и измерения через оператор MERGE

## Шаг 3: Обновление витрины
**Файл:** `SQL_update_customer_report_datamart.sql`

Этапы инкрементального обновление через CTE:

| Этап | Назначение |
|----|------------|
| `dwh_delta` | Выявление изменённых данных |
| `dwh_update_delta` | Поиск заказчиков для обновления |
| `dwh_delta_insert_result` | Расчёт новых данных для вставки |
| `dwh_delta_update_result` | Перерасчёт существующих данных |
| `insert_delta` | Вставка новых записей |
| `update_delta` | Обновление существующих записей |
| `insert_load_date` | Фиксация времени загрузки |
